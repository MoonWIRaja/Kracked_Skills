# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ # SKILL 5: WEB PERFORMANCE OPTIMIZATION # Scope: Project-wide | File: 05-web-perf.md # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ## When to Apply When optimizing page load times, fixing Core Web Vitals issues, reducing render-blocking resources, or improving runtime performance. ## Core Web Vitals Targets - **LCP** (Largest Contentful Paint): < 2.5s - **INP** (Interaction to Next Paint): < 200ms - **CLS** (Cumulative Layout Shift): < 0.1 ## LCP Optimization ### Common LCP Elements - Hero images, large text blocks, video poster images, CSS background images ### Optimization Strategies ```xml <!-- Preload critical hero image --> <link rel="preload" as="image" href="/hero.webp" fetchpriority="high"> <!-- Modern formats with fallback --> <picture> <source srcset="/hero.avif" type="image/avif"> <source srcset="/hero.webp" type="image/webp"> <img src="/hero.jpg" alt="Hero" fetchpriority="high"> </picture> ``` ```typescript // Next.js: priority prop for above-fold images <Image src="/hero.jpg" priority alt="Hero" /> ``` ### LCP Antipatterns - Lazy loading above-fold images - Client-side rendering of LCP element - Unoptimized image formats (PNG for photos) - Missing width/height causing layout recalculation ## CLS Prevention ### Always Reserve Space ```css img, video { aspect-ratio: 16/9; width: 100%; height: auto; } .ad-slot { min-height: 250px; } @font-face { font-family: 'Custom'; font-display: optional; size-adjust: 100.5%; } ``` ### CLS Antipatterns - Injecting content above existing content - Images without dimensions - Ads/embeds without reserved space - Web fonts causing text reflow - Dynamic content without skeleton ## INP Optimization ### Responsive Interactions ```typescript async function handleClick() { setLoading(true); await scheduler.yield(); const result = await processData(); setResult(result); } import { startTransition } from 'react'; startTransition(() => { setSearchResults(results); }); ``` ### INP Antipatterns - Long-running synchronous JavaScript - Large DOM updates blocking main thread - Missing loading/pending states - Heavy computation in event handlers ## Render-Blocking Resources ### Critical CSS ```xml <style>/* Above-fold styles only */</style> <link rel="preload" href="/styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> ``` ### JavaScript Loading ```xml <script defer src="/analytics.js"></script> <script async src="/chat-widget.js"></script> <script type="module" src="/app.js"></script> ``` ### Resource Hints ```xml <link rel="dns-prefetch" href="//api.example.com"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="prefetch" href="/dashboard"> <link rel="preload" href="/font.woff2" as="font" crossorigin> ``` ## Performance Budget - Total page weight: < 1.5MB - JavaScript: < 300KB (compressed) - CSS: < 50KB (compressed) - Fonts: < 100KB total - LCP image: < 200KB ## Monitoring - Use Lighthouse CI in pipeline - Set up Real User Monitoring (RUM) - Track CWV in Search Console - Alert on performance regressions