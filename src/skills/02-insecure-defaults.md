# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ # SKILL 2: INSECURE DEFAULTS DETECTION # Scope: Dev + QA | File: 02-insecure-defaults.md # ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ## When to Apply When writing or reviewing code that handles authentication, configuration, environment variables, cryptography, API keys, CORS settings, or any security-sensitive functionality. ## Hardcoded Secrets ### Never Hardcode - API keys, tokens, or credentials - Database connection strings - Encryption keys or salts - OAuth client secrets - Webhook signing secrets ### Detection Patterns ```typescript // BAD: Hardcoded secrets const API_KEY = "sk_live_abc123xyz"; const DB_URL = "postgresql://user:password@host:5432/db"; // GOOD: Environment variables const API_KEY = process.env.STRIPE_SECRET_KEY; const DB_URL = process.env.DATABASE_URL; ``` ### Required Checks - Scan for strings matching API key patterns (sk_, pk_, api_, key_, secret_) - Check for base64-encoded strings >20 characters in source - Flag any password/secret/key variable with literal assignment ## Authentication Defaults ### Dangerous Defaults ```typescript // BAD: Permissive defaults const config = { requireAuth: false, // Should default to true validateToken: false, // Should default to true sessionTimeout: 0, // Should have reasonable limit maxLoginAttempts: 0, // Should limit attempts }; // GOOD: Secure defaults const config = { requireAuth: true, validateToken: true, sessionTimeout: 3600, // 1 hour maxLoginAttempts: 5, }; ``` ## CORS Configuration ### Insecure Patterns ```typescript // BAD: Allow all origins app.use(cors({ origin: '*' })); app.use(cors({ origin: true })); // BAD: Reflect origin header app.use(cors({ origin: req.headers.origin })); // GOOD: Explicit allowlist app.use(cors({ origin: ['https://myapp.com', 'https://staging.myapp.com'], credentials: true, })); ``` ## Cryptography ### Weak Algorithms to Flag - MD5 for any security purpose - SHA1 for signatures or integrity - DES or 3DES encryption - ECB mode for any block cipher - Random without crypto source ### Required Patterns ```typescript // BAD: Weak hashing import { createHash } from 'crypto'; const hash = createHash('md5').update(password).digest('hex'); // GOOD: Strong hashing import bcrypt from 'bcrypt'; const hash = await bcrypt.hash(password, 12); // BAD: Insecure random const token = Math.random().toString(36); // GOOD: Cryptographically secure import { randomBytes } from 'crypto'; const token = randomBytes(32).toString('hex'); ``` ## HTTP Security Headers ### Required Headers ```typescript { 'Strict-Transport-Security': 'max-age=31536000; includeSubDomains', 'X-Content-Type-Options': 'nosniff', 'X-Frame-Options': 'DENY', 'X-XSS-Protection': '1; mode=block', 'Content-Security-Policy': "default-src 'self'", 'Referrer-Policy': 'strict-origin-when-cross-origin', } ``` ## File Upload Security ### Required Checks - Validate file type by magic bytes, not extension - Limit file size (e.g., 10MB max) - Generate random filenames server-side - Store outside web root or use signed URLs - No content-type validation bypass - Never use client-provided filenames directly